<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜ì–´ ë¬¸í•­ JSON Delta ë·°ì–´</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .file-selector {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .file-selector h2 {
            margin-bottom: 15px;
            color: #333;
        }

        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background-color: white;
            cursor: pointer;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
        }

        .content-area {
            display: grid;
            grid-template-rows: auto auto;
            gap: 20px;
            min-height: 600px;
        }

        .json-panel, .viewer-panel {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .panel-header {
            background: #333;
            color: white;
            padding: 15px 20px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-content {
            padding: 20px;
            overflow-y: auto;
        }

        .viewer-panel .panel-content {
            min-height: 400px;
            max-height: 70vh;
        }

        .json-panel .panel-content {
            height: 250px;
        }

        .json-tree {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
        }

        .json-key {
            color: #d73a49;
            font-weight: bold;
        }

        .json-string {
            color: #032f62;
        }

        .json-number {
            color: #005cc5;
        }

        .json-boolean {
            color: #e36209;
        }

        .json-null {
            color: #6f42c1;
        }

        .json-brace {
            color: #24292e;
            font-weight: bold;
        }

        .json-bracket {
            color: #24292e;
            font-weight: bold;
        }

        .json-expand {
            cursor: pointer;
            color: #586069;
            margin-right: 5px;
            user-select: none;
        }

        .json-expand:hover {
            color: #0366d6;
        }

        .collapsed {
            display: none;
        }

        .item-viewer {
            margin-bottom: 20px;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            overflow: hidden;
        }

        .item-header {
            background: #f6f8fa;
            padding: 12px 16px;
            border-bottom: 1px solid #e1e4e8;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .item-header:hover {
            background: #f1f3f4;
        }

        .item-content {
            padding: 16px;
        }

        .item-section {
            margin-bottom: 15px;
        }

        .section-title {
            font-weight: bold;
            color: #0366d6;
            margin-bottom: 8px;
            border-bottom: 1px solid #e1e4e8;
            padding-bottom: 4px;
        }

        .annotation-text {
            background: #f8f9fa;
            padding: 10px;
            border-left: 4px solid #0366d6;
            border-radius: 4px;
            margin: 5px 0;
            font-family: Arial, sans-serif;
            line-height: 1.5;
        }

        .annotation-html {
            background: #fff5f5;
            border-left: 4px solid #dc3545;
        }

        .bbox-info {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #6a737d;
            margin-top: 5px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6a737d;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .stats {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #0366d6;
        }

        .stat-label {
            font-size: 0.9em;
            color: #586069;
        }

        .toggle-btn {
            background: #0366d6;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .toggle-btn:hover {
            background: #0256cc;
        }

        @media (max-width: 768px) {
            .content-area {
                grid-template-rows: 1fr 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }

            .viewer-panel .panel-content {
                min-height: 300px;
                max-height: 60vh;
            }

            .json-panel .panel-content {
                height: 200px;
            }
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.snow.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.js"></script>
</head>
<body>
    <div class="header">
        <h1>ğŸ” ì˜ì–´ ë¬¸í•­ JSON Delta ë·°ì–´</h1>
        <p>ì¤‘ê³ ë“±í•™ìƒ ì˜ì–´ ë¬¸í•­ ë°ì´í„°ë¥¼ êµ¬ì¡°í™”ëœ í˜•íƒœë¡œ ë¶„ì„í•˜ê³  ì‹œê°í™”í•©ë‹ˆë‹¤</p>
    </div>

    <div class="container">
        <div class="file-selector">
            <h2>ğŸ“‚ JSON íŒŒì¼ ì„ íƒ</h2>
            <select id="fileSelect">
                <option value="">íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”...</option>
            </select>
        </div>

        <div id="statsArea"></div>

        <div class="content-area">
            <div class="viewer-panel">
                <div class="panel-header">
                    <span>ğŸ“ ë¬¸í•­ ë·°ì–´</span>
                    <button class="toggle-btn" onclick="toggleAllItems()">ì „ì²´ í† ê¸€</button>
                </div>
                <div class="panel-content">
                    <div id="itemViewer">
                        JSON íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”...
                    </div>
                </div>
            </div>

            <div class="json-panel">
                <div class="panel-header">
                    <span>ğŸ”§ JSON Delta êµ¬ì¡°</span>
                    <button class="toggle-btn" onclick="toggleAllJson()">ì „ì²´ í† ê¸€</button>
                </div>
                <div class="panel-content">
                    <div id="jsonTree" class="json-tree">
                        JSON íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentData = null;
        let jsonExpanded = {};
        let itemsExpanded = {};

        // JSON íŒŒì¼ ëª©ë¡ ë¡œë“œ
        async function loadFileList() {
            try {
                const response = await fetch('output/');
                const text = await response.text();
                
                // ê°„ë‹¨í•œ íŒŒì¼ ëª©ë¡ íŒŒì‹± (ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ APIë¡œ ì œê³µí•˜ëŠ” ê²ƒì´ ì¢‹ìŒ)
                const files = [];
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'text/html');
                const links = doc.querySelectorAll('a[href$=".json"]');
                
                links.forEach(link => {
                    files.push(link.getAttribute('href'));
                });

                // Hardcoded full file list
                const fileList = [
'ENG_3353702032983721408.json',
'ENG_3353703026094245313.json',
'ENG_3354487953991665267.json',
'ENG_3354542488458102395.json',
'ENG_3357318152177321967.json',
'ENG_3358138854778340386.json',
'ENG_3454773956039411701.json',
'ENG_3455259272915452928.json',
'ENG_3456147124486407219.json',
'ENG_3457258796248728646.json',
'ENG_3457311414606103625.json',
'ENG_3457498846416864340.json',
'ENG_3457580424304264280.json',
'ENG_3457588489405596764.json',
'ENG_3458367275919213681.json',
'ENG_3458372944009364597.json',
'ENG_3458379379799753849.json',
'ENG_3459588782905361559.json',
'ENG_3468563170841331031.json',
'ENG_3598922251862279775.json',
'ENG_3605354571162977353.json',
'ENG_3606835933535536511.json',
'ENG_3608396544186779469.json',
'ENG_3608397308296693583.json',
'ENG_3609148354841281537.json',
'ENG_3610427845085496554.json',
'ENG_3611903530685695801.json',
'ENG_3612772779083957710.json',
'ENG_3613391395915564819.json',
'ENG_3613392057852233492.json',
'ENG_3614031293689365663.json',
'ENG_3614747270651578097.json',
'ENG_3614747868918712050.json',
'ENG_3615654362006685292.json',
'ENG_3618438688792380499.json',
'ENG_3618493443065513065.json',
'ENG_3618561773637993658.json',
'ENG_3618562475965809852.json',
'ENG_3620626452732446280.json',
'ENG_3620751517516039774.json',
'ENG_3622747302164170492.json',
'ENG_3622859508780369674.json',
'ENG_3624356880106653536.json',
'ENG_3628511610177324742.json',
'ENG_3628513292898535111.json',
'ENG_3634973571974957054.json',
'ENG_3637866616126965026.json',
'ENG_3638141874742494582.json',
'ENG_3638142751444305272.json',
'ENG_3638143426047772026.json',
'ENG_3643786207910954526.json',
'ENG_3644670117331076699.json',
'ENG_3647292165681317007.json',
'ENG_3647337308849439896.json',
'ENG_3647542043221165227.json',
'ENG_3647564126240113836.json',
'ENG_3648240845624182005.json',
'ENG_3648688864005981455.json',
'ENG_3648808808509080855.json',
'ENG_3648809576561640728.json',
'ENG_3648812641591231769.json',
'ENG_3649044203897357632.json',
'ENG_3649375563736417632.json',
'ENG_3649525852141520261.json',
'ENG_3649526338546566534.json',
'ENG_3650201815166748078.json',
'ENG_3650221789943956912.json',
'ENG_3651143660306695717.json',
'ENG_3651210070668084809.json',
'ENG_3651216427488118347.json',
'ENG_3651593006789690981.json',
'ENG_3651595026749720167.json',
'ENG_3651596197405132394.json',
'ENG_3651597395097028204.json',
'ENG_3651700390350554831.json',
'ENG_3651818652946138898.json',
'ENG_3652296050087036749.json',
'ENG_3652594165260223523.json',
'ENG_3652699797137130569.json',
'ENG_3653084355934291029.json',
'ENG_3654610324687947514.json',
'ENG_3654931862918268696.json',
'ENG_3655150235287553817.json',
'ENG_3655215841240155937.json',
'ENG_3656715025134913486.json',
'ENG_3656719539791464399.json',
'ENG_3656825902634895314.json',
'ENG_3657108583910212685.json',
'ENG_3657597492419101875.json',
'ENG_3657750060738806983.json',
'ENG_3657750873393595592.json',
'ENG_3658331924025312492.json',
'ENG_3658426755141600547.json',
'ENG_3658427390964532516.json',
'ENG_3658428010463233317.json',
'ENG_3658428787088950566.json',
'ENG_3659147182914667923.json',
'ENG_3660703797124007414.json',
'ENG_3660721619208242680.json'
                ];

                const select = document.getElementById('fileSelect');
                fileList.forEach(file => {
                    const option = document.createElement('option');
                    option.value = file;
                    option.textContent = file.replace('.json', '');
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('íŒŒì¼ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                // ê¸°ë³¸ íŒŒì¼ ëª©ë¡ ì‚¬ìš©
                const defaultFiles = [
                    'ENG_3657597492419101875.json',
                    'ENG_3660703797124007414.json',
                    'ENG_3660721619208242680.json'
                ];
                
                const select = document.getElementById('fileSelect');
                defaultFiles.forEach(file => {
                    const option = document.createElement('option');
                    option.value = file;
                    option.textContent = file.replace('.json', '');
                    select.appendChild(option);
                });
            }
        }

        // JSON íŒŒì¼ ë¡œë“œ
        async function loadJsonFile(filename) {
            try {
                document.getElementById('jsonTree').innerHTML = '<div class="loading">íŒŒì¼ì„ ë¡œë“œí•˜ëŠ” ì¤‘...</div>';
                document.getElementById('itemViewer').innerHTML = '<div class="loading">íŒŒì¼ì„ ë¡œë“œí•˜ëŠ” ì¤‘...</div>';
                
                const response = await fetch(`output/${filename}`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                currentData = data;
                
                displayStats(data);
                displayJsonTree(data);
                displayItemViewer(data);
                
            } catch (error) {
                console.error('JSON íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('jsonTree').innerHTML = `<div class="error">íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨: ${error.message}</div>`;
                document.getElementById('itemViewer').innerHTML = `<div class="error">íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨: ${error.message}</div>`;
            }
        }

        // í†µê³„ ì •ë³´ í‘œì‹œ
        function displayStats(data) {
            const stats = {
                items: data.items ? data.items.length : 0,
                images: data.images ? data.images.length : 0,
                annotations: data.annotations ? data.annotations.length : 0,
                categories: data.categories ? data.categories.length : 0
            };

            const statsHtml = `
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-number">${stats.items}</div>
                        <div class="stat-label">ë¬¸í•­ ìˆ˜</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${stats.images}</div>
                        <div class="stat-label">ì´ë¯¸ì§€ ìˆ˜</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${stats.annotations}</div>
                        <div class="stat-label">ì£¼ì„ ìˆ˜</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${stats.categories}</div>
                        <div class="stat-label">ì¹´í…Œê³ ë¦¬ ìˆ˜</div>
                    </div>
                </div>
            `;

            document.getElementById('statsArea').innerHTML = statsHtml;
        }

        // JSON íŠ¸ë¦¬ í‘œì‹œ
        function displayJsonTree(data) {
            const jsonTree = document.getElementById('jsonTree');
            jsonTree.innerHTML = createJsonNode(data, 'root', 0);
        }

        // JSON ë…¸ë“œ ìƒì„±
        function createJsonNode(value, key, depth) {
            const indent = '  '.repeat(depth);
            const nodeId = `node_${key}_${depth}_${Math.random().toString(36).substr(2, 9)}`;
            
            if (value === null) {
                return `${indent}<span class="json-key">"${key}"</span>: <span class="json-null">null</span>`;
            }
            
            if (typeof value === 'string') {
                const displayValue = value.length > 100 ? value.substring(0, 100) + '...' : value;
                return `${indent}<span class="json-key">"${key}"</span>: <span class="json-string">"${escapeHtml(displayValue)}"</span>`;
            }
            
            if (typeof value === 'number') {
                return `${indent}<span class="json-key">"${key}"</span>: <span class="json-number">${value}</span>`;
            }
            
            if (typeof value === 'boolean') {
                return `${indent}<span class="json-key">"${key}"</span>: <span class="json-boolean">${value}</span>`;
            }
            
            if (Array.isArray(value)) {
                const isExpanded = jsonExpanded[nodeId] !== false;
                const toggleIcon = isExpanded ? 'â–¼' : 'â–¶';
                const contentClass = isExpanded ? '' : 'collapsed';
                
                let html = `${indent}<span class="json-expand" onclick="toggleJsonNode('${nodeId}')">${toggleIcon}</span>`;
                html += `<span class="json-key">"${key}"</span>: <span class="json-bracket">[</span>`;
                html += ` <span style="color: #6a737d;">(${value.length} items)</span>\n`;
                
                html += `<div id="${nodeId}" class="${contentClass}">`;
                value.slice(0, 10).forEach((item, index) => {
                    html += createJsonNode(item, index, depth + 1) + '\n';
                });
                if (value.length > 10) {
                    html += `${indent}  <span style="color: #6a737d;">... ${value.length - 10} more items</span>\n`;
                }
                html += `</div>`;
                html += `${indent}<span class="json-bracket">]</span>`;
                
                return html;
            }
            
            if (typeof value === 'object') {
                const keys = Object.keys(value);
                const isExpanded = jsonExpanded[nodeId] !== false;
                const toggleIcon = isExpanded ? 'â–¼' : 'â–¶';
                const contentClass = isExpanded ? '' : 'collapsed';
                
                let html = `${indent}<span class="json-expand" onclick="toggleJsonNode('${nodeId}')">${toggleIcon}</span>`;
                html += `<span class="json-key">"${key}"</span>: <span class="json-brace">{</span>`;
                html += ` <span style="color: #6a737d;">(${keys.length} keys)</span>\n`;
                
                html += `<div id="${nodeId}" class="${contentClass}">`;
                keys.slice(0, 10).forEach(objKey => {
                    html += createJsonNode(value[objKey], objKey, depth + 1) + '\n';
                });
                if (keys.length > 10) {
                    html += `${indent}  <span style="color: #6a737d;">... ${keys.length - 10} more keys</span>\n`;
                }
                html += `</div>`;
                html += `${indent}<span class="json-brace">}</span>`;
                
                return html;
            }
            
            return `${indent}<span class="json-key">"${key}"</span>: <span>${escapeHtml(String(value))}</span>`;
        }

        // JSON ë…¸ë“œ í† ê¸€
        function toggleJsonNode(nodeId) {
            const node = document.getElementById(nodeId);
            const isExpanded = !node.classList.contains('collapsed');
            
            jsonExpanded[nodeId] = !isExpanded;
            node.classList.toggle('collapsed');
            
            // í† ê¸€ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
            const expandElement = node.parentElement.querySelector('.json-expand');
            expandElement.textContent = isExpanded ? 'â–¶' : 'â–¼';
        }

        // ë¬¸í•­ ë·°ì–´ í‘œì‹œ
        function displayItemViewer(data) {
            const viewer = document.getElementById('itemViewer');
            
            if (!data.items || data.items.length === 0) {
                viewer.innerHTML = '<div class="error">ë¬¸í•­ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            let html = '';
            data.items.forEach((item, index) => {
                const itemId = `item_${index}`;
                const isExpanded = itemsExpanded[itemId] !== false;
                const toggleIcon = isExpanded ? 'â–¼' : 'â–¶';
                const contentClass = isExpanded ? '' : 'collapsed';

                html += `
                    <div class="item-viewer">
                        <div class="item-header" onclick="toggleItem('${itemId}')">
                            <span>${toggleIcon} ë¬¸í•­ ${item.id} (Image: ${item.imageIds ? item.imageIds.join(', ') : 'N/A'})</span>
                            <span style="font-size: 0.9em; color: #6a737d;">${item.answerType || 'N/A'}</span>
                        </div>
                        <div id="${itemId}" class="item-content ${contentClass}">
                            ${createItemContent(item, data)}
                        </div>
                    </div>
                `;
            });

            viewer.innerHTML = html;

            // Initialize Quill for all rendered areas
            document.querySelectorAll('.annotation-html').forEach(el => {
                const quill = new Quill(el, {
                    theme: 'snow',
                    readOnly: true
                });
                quill.clipboard.dangerouslyPasteHTML(el.dataset.html);
            });
        }

        // ë¬¸í•­ ë‚´ìš© ìƒì„±
        function createItemContent(item, data) {
            let html = '';

            // ì§€ë¬¸ ì˜ì—­
            if (item.passageAreaInfo && item.passageAreaInfo.annotationIds) {
                html += `<div class="item-section">
                    <div class="section-title">ğŸ“– ì§€ë¬¸ ì˜ì—­</div>`;
                item.passageAreaInfo.annotationIds.forEach(id => {
                    const annotation = findAnnotation(data, id);
                    if (annotation) {
                        html += createAnnotationDisplay(annotation);
                    }
                });
                html += `</div>`;
            }

            // ë¬¸ì œ ì˜ì—­
            if (item.questionAreaInfo && item.questionAreaInfo.annotationIds) {
                html += `<div class="item-section">
                    <div class="section-title">â“ ë¬¸ì œ ì˜ì—­</div>`;
                item.questionAreaInfo.annotationIds.forEach(id => {
                    const annotation = findAnnotation(data, id);
                    if (annotation) {
                        html += createAnnotationDisplay(annotation);
                    }
                });
                html += `</div>`;
            }

            // ë‹µì•ˆ ì˜ì—­
            if (item.answerAreaInfo && item.answerAreaInfo.annotationIds) {
                html += `<div class="item-section">
                    <div class="section-title">âœ… ë‹µì•ˆ ì˜ì—­</div>`;
                item.answerAreaInfo.annotationIds.forEach(id => {
                    const annotation = findAnnotation(data, id);
                    if (annotation) {
                        html += createAnnotationDisplay(annotation);
                    }
                });
                html += `</div>`;
            }

            // í•´ì„¤ ì˜ì—­
            if (item.explanationAreaInfo && item.explanationAreaInfo.annotationIds) {
                html += `<div class="item-section">
                    <div class="section-title">ğŸ’¡ í•´ì„¤ ì˜ì—­</div>`;
                item.explanationAreaInfo.annotationIds.forEach(id => {
                    const annotation = findAnnotation(data, id);
                    if (annotation) {
                        html += createAnnotationDisplay(annotation);
                    }
                });
                html += `</div>`;
            }

            return html;
        }

        // ì£¼ì„ ì°¾ê¸°
        function findAnnotation(data, id) {
            if (!data.annotations) return null;
            return data.annotations.find(ann => ann.id === id);
        }

        // ì£¼ì„ í‘œì‹œ ìƒì„±
        function createAnnotationDisplay(annotation) {
            if (!annotation) return '';

            const hasHtml = annotation.html && annotation.html.trim();
            let htmlRender = '';
            if (hasHtml) {
                const uniqueId = Math.random().toString(36).substr(2, 9);
                htmlRender = `<div><strong>HTML Rendered:</strong></div><div id="quill-${uniqueId}" class="annotation-html" data-html='${escapeHtml(annotation.html)}'></div>`;
            }

            return `
                <div class="annotation-text ${hasHtml ? 'annotation-html' : ''}">
                    ${htmlRender}
                    <div><strong>í…ìŠ¤íŠ¸:</strong> ${escapeHtml(annotation.text || '')}</div>
                    <div class="bbox-info">
                        ìœ„ì¹˜: [${annotation.bbox ? annotation.bbox.map(n => n.toFixed(1)).join(', ') : 'N/A'}] | 
                        ì´ë¯¸ì§€ ID: ${annotation.image_id || 'N/A'} | 
                        ì¹´í…Œê³ ë¦¬ ID: ${annotation.category_id || 'N/A'}
                    </div>
                </div>
            `;
        }

        // ë¬¸í•­ í† ê¸€
        function toggleItem(itemId) {
            const item = document.getElementById(itemId);
            const isExpanded = !item.classList.contains('collapsed');
            
            itemsExpanded[itemId] = !isExpanded;
            item.classList.toggle('collapsed');
            
            // í† ê¸€ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
            const header = item.parentElement.querySelector('.item-header');
            const currentText = header.querySelector('span').textContent;
            const newIcon = isExpanded ? 'â–¶' : 'â–¼';
            header.querySelector('span').textContent = currentText.replace(/^[â–¼â–¶]/, newIcon);
        }

        // ì „ì²´ JSON í† ê¸€
        function toggleAllJson() {
            const allNodes = document.querySelectorAll('#jsonTree [id^="node_"]');
            const shouldExpand = allNodes.length > 0 && allNodes[0].classList.contains('collapsed');
            
            allNodes.forEach(node => {
                const nodeId = node.id;
                jsonExpanded[nodeId] = shouldExpand;
                
                if (shouldExpand) {
                    node.classList.remove('collapsed');
                } else {
                    node.classList.add('collapsed');
                }
                
                // í† ê¸€ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
                const expandElement = node.parentElement.querySelector('.json-expand');
                if (expandElement) {
                    expandElement.textContent = shouldExpand ? 'â–¼' : 'â–¶';
                }
            });
        }

        // ì „ì²´ ë¬¸í•­ í† ê¸€
        function toggleAllItems() {
            const allItems = document.querySelectorAll('[id^="item_"]');
            const shouldExpand = allItems.length > 0 && allItems[0].classList.contains('collapsed');
            
            allItems.forEach(item => {
                const itemId = item.id;
                itemsExpanded[itemId] = shouldExpand;
                
                if (shouldExpand) {
                    item.classList.remove('collapsed');
                } else {
                    item.classList.add('collapsed');
                }
                
                // í† ê¸€ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
                const header = item.parentElement.querySelector('.item-header');
                const currentText = header.querySelector('span').textContent;
                const newIcon = shouldExpand ? 'â–¼' : 'â–¶';
                header.querySelector('span').textContent = currentText.replace(/^[â–¼â–¶]/, newIcon);
            });
        }

        // HTML ì´ìŠ¤ì¼€ì´í”„
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('fileSelect').addEventListener('change', function(e) {
            if (e.target.value) {
                loadJsonFile(e.target.value);
            }
        });

        // ì´ˆê¸°í™”
        loadFileList();
    </script>
</body>
</html> 